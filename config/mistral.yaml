verbose: false
compute_ppl: true
return_block_size: true
logging: true
em_splitter: surprisal

max_len: 8192        # ðŸ”» Lowered max_len from ~2B to 32K (realistic for long context)
chunk_size: 128       # ðŸ”» Reduces memory during generation
conv_type: mistral-inst
extended_passkey: 1024

model:
  type: em-llm
  path: mistralai/Mistral-7B-Instruct-v0.2
  min_block_size: 8
  max_block_size: 32          # ðŸ”» Reduce to lessen attention buffer
  n_init: 64                  # ðŸ”» Lower initialization size
  n_local: 1024               # ðŸ”» Halve local memory to reduce usage
  n_mem: 512                 # ðŸ”» Halve retained memory
  repr_topk: 4
  max_cached_block: 128       # ðŸ”» Reduce from 512
  exc_block_size: 128         # ðŸ”» Match to above
  base: 1000000
  distance_scale: 1.0
  surprisal_threshold_gamma: 1.0

  min_free_cpu_memory: 50
  disk_offload_threshold: 50000     # ðŸ”» Lower threshold for safer offload
  vector_offload_threshold: 5000    # ðŸ”» More aggressive offload

  similarity_refinement_kwargs:
    similarity_refinement: false
    refine_with_buffer: true
    refine_from_layer: 20
    similarity_metric: modularity

  contiguity_buffer_kwargs:
    use_contiguity_buffer: false
    contiguity_buffer_size: 0.3

  uniform_blocks: false
  random_topk_blocks: false
